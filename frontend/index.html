<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-eval' https://cdn.jsdelivr.net">

    <title>RPS Lizard Spock - Web3 Game</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* Timer styling */
        .timer-display {
            margin-top: 15px;
            padding: 10px;
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 4px;
            text-align: center;
        }

        .timer-display p:first-child {
            margin: 0;
            font-weight: bold;
            font-size: 12px;
        }

        .timer-display p:last-child {
            margin: 5px 0 0 0;
            font-size: 20px;
            font-weight: bold;
            font-family: 'Courier New', monospace;
            color: #4CAF50;
        }

        /* Results display styling */
        .results-box {
            padding: 15px;
            background: #e8f5e9;
            border: 2px solid #4CAF50;
            border-radius: 4px;
            margin-top: 10px;
        }

        .results-box.timeout {
            background: #ffebee;
            border-color: #f44336;
        }

        .results-box h3 {
            margin: 10px 0 5px 0;
            color: #333;
        }

        .results-box p {
            margin: 5px 0;
            font-size: 14px;
        }

        /* Status message styling */
        #status {
            padding: 12px;
            margin-bottom: 15px;
            border-radius: 4px;
            display: none;
            font-weight: 500;
        }

        #status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        #status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        #status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        #status.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        /* Timeout button highlighting */
        .btn-timeout.available {
            background: #ff6b6b !important;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(255, 107, 107, 0.7); }
            50% { box-shadow: 0 0 0 10px rgba(255, 107, 107, 0); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÆ Rock Paper Scissors Lizard Spock</h1>
        <p id="mode-indicator" style="text-align: center; font-size: 14px; color: #2196F3; margin-bottom: 10px;">
            Player 1 Mode: Create Game
        </p>
        
        <!-- Wallet Connection -->
        <div id="wallet-section">
            <button id="connect-btn">Connect MetaMask</button>
            <p id="wallet-address"></p>
        </div>

        <!-- Status Messages -->
        <div id="status"></div>

        <!-- Create Game (Player 1) -->
        <div id="create-game-section" class="section hidden">
            <h2>üéØ Create New Game (Player 1)</h2>
            <div class="form-group">
                <label>Your Move:</label>
                <select id="p1-move">
                    <option value="1">‚úä Rock</option>
                    <option value="2">‚úã Paper</option>
                    <option value="3">‚úåÔ∏è Scissors</option>
                    <option value="4">üññ Spock</option>
                    <option value="5">ü¶é Lizard</option>
                </select>
            </div>
            <div class="form-group">
                <label>Player 2 Address:</label>
                <input type="text" id="p2-address" placeholder="0x..." required>
            </div>
            <div class="form-group">
                <label>Stake Amount (ETH):</label>
                <input type="text" id="stake-amount" placeholder="0.001" required>
            </div>
            <button id="create-game-btn" class="btn-primary">Create Game</button>
            <div id="game-info" class="info-box"></div>
        </div>

        <!-- Join Game (Player 2) -->
        <div id="join-game-section" class="section hidden">
            <h2>ü§ù Join Game (Player 2)</h2>
            <div class="form-group">
                <label>Game Contract Address:</label>
                <input type="text" id="contract-address" placeholder="0x..." required>
                <small style="color: #666;">This should be auto-filled if you clicked a shared link</small>
            </div>
            <button id="load-game-btn">Load Game</button>
            <div id="game-details" class="info-box"></div>
            
            <div class="form-group">
                <label>Your Move:</label>
                <select id="p2-move" class="hidden">
                    <option value="1">‚úä Rock</option>
                    <option value="2">‚úã Paper</option>
                    <option value="3">‚úåÔ∏è Scissors</option>
                    <option value="4">üññ Spock</option>
                    <option value="5">ü¶é Lizard</option>
                </select>
            </div>
            <button id="play-move-btn" class="hidden btn-primary">Play Move</button>
        </div>

        <!-- Reveal (Player 1) -->
        <div id="reveal-section" class="section hidden">
            <h2>üîì Reveal Move (Player 1)</h2>
            <div class="form-group">
                <label>Game Contract Address:</label>
                <input type="text" id="reveal-contract" placeholder="0x...">
                <small style="color: #666;">Your move and salt are saved in localStorage</small>
            </div>
            <button id="reveal-btn" class="btn-primary">Reveal Move</button>
            <div id="game-results" class="info-box"></div>
        </div>

        <!-- Timeout Buttons -->
        <div id="timeout-section" class="section hidden">
            <h2>‚è±Ô∏è Timeout Actions</h2>
            <div class="form-group">
                <label>Game Contract Address:</label>
                <input type="text" id="timeout-contract" placeholder="0x...">
            </div>
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <button id="j1-timeout-btn" class="btn-timeout">P2 Timeout Claim (J1)</button>
                <button id="j2-timeout-btn" class="btn-timeout">P1 Timeout Claim (J2)</button>
            </div>
            <small style="color: #666; display: block; margin-top: 10px;">
                Use after 5 minutes of inactivity from opponent
            </small>
            <div id="timeout-results"></div>
        </div>

        <!-- Game Rules -->
        <div class="rules-section section" style="margin-top: 30px; padding: 15px; background: #f5f5f5; border-radius: 8px;">
            <h3>üìú Game Rules</h3>
            <ul style="font-size: 14px;">
                <li>Rock crushes Scissors & Lizard</li>
                <li>Paper covers Rock & disproves Spock</li>
                <li>Scissors cuts Paper & decapitates Lizard</li>
                <li>Spock vaporizes Rock & smashes Scissors</li>
                <li>Lizard eats Paper & poisons Spock</li>
            </ul>
            <p style="font-size: 12px; color: #666; margin-top: 10px;">
                ‚è±Ô∏è <strong>Timeout Rules:</strong>
                <br/>Phase 1: Player 2 has 5 minutes to play after game creation
                <br/>Phase 2: Player 1 has 5 minutes to reveal after Player 2 plays
                <br/>If timeout expires, opponent can claim timeout to win the game
            </p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/ethers@6.13.0/dist/ethers.umd.min.js"></script>
    <script src="./js/config.js"></script>
    <script type="module" src="./js/web3-init.js"></script>
    <script type="module" src="./js/game-logic.js"></script>
    <script type="module" src="./js/app.js"></script>
</body>
</html>